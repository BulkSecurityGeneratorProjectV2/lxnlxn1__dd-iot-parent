<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <title>项目组</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/materialdesignicons.min.css" rel="stylesheet">
    <link href="css/style.min.css" rel="stylesheet">
</head>

<body>
<div class="lyear-layout-web">
    <div class="lyear-layout-container">

        <nav class="navbar navbar-default">
            <div class="topbar">

                <div class="topbar-left">
                    <span>DREAMDECK IOT云平台</span>
                </div>
            </div>
        </nav>
        <!--左侧导航-->
        <aside class="lyear-layout-sidebar">
            <!-- logo -->
            <div id="logo" class="sidebar-header">

            </div>
            <div class="lyear-layout-sidebar-scroll">

                <nav class="sidebar-main">
                    <ul class="nav nav-drawer" id="menuList">


                    </ul>
                </nav>

            </div>
        </aside>
        <!--End 左侧导航-->
        <!--页面主要内容-->
        <main class="lyear-layout-content">

            <div class="container-fluid">

                <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <div class="card-toolbar clearfix">
                                <h2>设备列表</h2>
                                <form class="pull-right search-bar" method="get" action="#!" role="form">
                                    <div class="input-group">
                                        <div class="input-group-btn">
                                            <input type="hidden" name="search_field" id="search-field" value="title">

                                        </div>
                                        <input type="text" class="form-control" value="" name="keyword"
                                               placeholder="请输入名称">
                                    </div>
                                </form>
                            </div>
                            <div class="card-body">

                                <div class="table-responsive">
                                    <table class="table table-hover">
                                        <thead>
                                        <tr>
                                            <th>设备id</th>
                                            <th>设备名称</th>
                                            <th>设备品牌</th>
                                            <th>设备型号</th>
                                            <th>运行状态</th>
                                            <th>安装时间</th>
                                            <th>安装人员</th>
                                        </tr>
                                        </thead>
                                        <tbody id="deviceList">

                                        </tbody>
                                    </table>
                                </div>
                                <ul class="pagination">
                                    <li class="disabled"><span>«</span></li>
                                    <li class="active"><span>1</span></li>
                                    <li><a href="#!">»</a></li>
                                </ul>

                            </div>
                        </div>
                    </div>

                </div>

            </div>

        </main>
        <!--End 页面主要内容-->
    </div>
</div>

<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/url.js"></script>
<script type="text/javascript" src="js/localStorage.js"></script>
<script type="text/javascript" src="js/check.js"></script>
<script>
    var data = foowwLocalStorage.get('tocken');
    var obj = JSON.parse(data);

    var projectId = sessionStorage.getItem('projectId');
    var objs = JSON.parse(projectId);
    $(function () {

        $.ajax({
            type: "get",
            dataType: "json",
            url: GlobalConfig.IPSSAddress + "iot/project/projectInfo",
            data: {
                "projectId": objs,
            },
            beforeSend: function (XMLHttpRequest) {
                XMLHttpRequest.setRequestHeader("Authorization", "Bearer " + obj["access_token"]);
            },
            success: function (res) {
                $("#logo").html(" <h2 onclick='hrefIndex()' style=\"text-align: center\">←" + res.data.projectName + "</h2>");
            }
        });


        $.ajax({
            type: "post",
            dataType: "json",
            url: GlobalConfig.IPSSAddress + "iot/device/list",
            data: {
                projectId: objs
            },
            success: function (res) {
                //$("#logo").html(" <h2 style=\"text-align: center\">"+res.data.projectName+"</h2>");
                console.log(res.data.records);
                var html = "";
                for (var i = 0; i < res.data.records.length; i++) {
                    html += "<tr id=\"deviceList\" onclick=\"hrefInfo(" + res.data.records[i].deviceId + ")\">\n" +
                        "<td>" + res.data.records[i].deviceId + "</td>" +
                        "<td>" + res.data.records[i].deviceName + "</td>" +
                        "<td>" + res.data.records[i].brandName + "</td>" +
                        "<td>" + res.data.records[i].modelName + "</td>"
                    if (res.data.records[i].status == 0) {
                        html += "<td><font class=\"text-success\">在线</font></td>"
                    } else {
                        html += "<td><font class=\"text-faild\">离线</font></td>"
                    }

                    html += "<td>" + res.data.records[i].createTime + "</td>" +
                        "<td>" + res.data.records[i].userName + "</td>" +
                        "</tr>";
                }
                console.log(html);
                $("#deviceList").html(html);
            }
        })


        $.ajax({
            type: "get",
            dataType: "json",
            url: GlobalConfig.IPSSAddress + "admin/menu/tree",
            success: function (res) {
                console.log(res);
                var tree = JSON.parse(JSON.stringify(res));
                var html = "";
                for (var i = 0; i < tree.data.length; i++) {
                    if (tree.data[i].id == 2000) {
                        for (var k = 0; k < tree.data[i].children.length; k++) {
                            html += "<li class=\"nav-item  \" >" +
                                "<a href=" + tree.data[i].children[k].path + ".html" + ">" + tree.data[i].children[k].name + "</a>" +
                                "<ul class=\"nav nav-subnav\">\n" +
                                "</ul>" +
                                "</li>";
                        }
                    }
                }
                $("#menuList").html(html);
            }
        })

        $.ajax({
            type: "get",
            dataType: "json",
            url: GlobalConfig.IPSSAddress + "admin/role/list",
            beforeSend: function (XMLHttpRequest) {
                XMLHttpRequest.setRequestHeader("Authorization", "Bearer " + obj["access_token"]);
            },
            success: function (res) {
                console.log(res);
                html = ""
                for (var i = 0; i < res.data.length; i++) {
                    html += "<div class=\"example-box\">\n" +
                        "                                   <span class=\"nav-item\" onclick=\"roleClick(this)\" id=" + res.data[i].roleId + ">" + res.data[i].roleName + "</span>\n" +
                        "                                   <span class=\"mdi mdi-lead-pencil\" onclick=\"roleEdit(this)\" id=" + res.data[i].roleId + " name=" + res.data[i].roleName + "></span>\n" +
                        "                                   <span class=\"mdi mdi-delete-empty \" onclick=\"roleDelect(this)\" id=" + res.data[i].roleId + "></span>\n" +
                        "\n" +
                        "                               </div>\n";
                }
                $("#roleList").html(html);
            }
        })

    })

    function hrefIndex() {
        location.href = "index.html";
    }

    function hrefInfo(objs) {
        location.href = "deviceInfo.html?deviceId=" + objs;

    }

    function getQueryString() {
        var obg = {}, a = '';
        (a = window.location.search.substr(1)) || (a = window.location.hash.split('?')[1])
        a.split(/&/g).forEach(function (item) {
            obg[(item = item.split('='))[0]] = item[1];
        })
        return obg
    }


</script>