<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <title>项目文档</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/materialdesignicons.min.css" rel="stylesheet">
    <link href="css/style.min.css" rel="stylesheet">
    <link href="https://www.17sucai.com/preview/1/2017-08-21/bootstrap-fileinput/css/bootstrap-fileinput.css"
          rel="stylesheet">
</head>

<body>
<div class="lyear-layout-web">
    <div class="lyear-layout-container">
        <nav class="navbar navbar-default">
            <div class="topbar">

                <div class="topbar-left">
                    <span>DREAMDECK IOT云平台</span>
                </div>
            </div>
        </nav>
        <!--左侧导航-->
        <aside class="lyear-layout-sidebar">
            <!-- logo -->
            <div id="logo" class="sidebar-header">

            </div>
            <div class="lyear-layout-sidebar-scroll">

                <nav class="sidebar-main">
                    <ul class="nav nav-drawer" id="menuList">


                    </ul>
                </nav>

            </div>
        </aside>
        <!--End 左侧导航-->
        <!--页面主要内容-->
        <main class="lyear-layout-content">

            <div class="container-fluid">

                <div class="row">
                    <div class="col-lg-12">
                        <div class="card">
                            <h2>项目文档</h2>
                        </div>
                    </div>
                    <div class="col-md-2">
                        <div class="card" onclick="hrefAdd()">
                            <img src="images/add.png">
                        </div>

                    </div>
                    <div class="col-md-2" onclick="docList(1)">
                        <div class="card">
                            <img src="images/file.png">
                            <div class="card-header">安装施工图</div>
                        </div>

                    </div>

                    <div class="col-md-2" onclick="docList(2)">
                        <div class="card">
                            <img src="images/file.png">
                            <div class="card-header">系统拓扑图</div>
                        </div>

                    </div>
                    <div class="col-md-2" onclick="docList(3)">
                        <div class="card">
                            <img src="images/file.png">
                            <div class="card-header">电器原理图</div>
                        </div>

                    </div>
                    <div class="col-md-2" onclick="docList(4)">
                        <div class="card">
                            <img src="images/file.png">
                            <div class="card-header">网络拓扑图</div>
                        </div>

                    </div>
                    <div class="col-md-2" onclick="docList(5)">
                        <div class="card">
                            <img src="images/file.png">
                            <div class="card-header">设备点位图</div>
                        </div>

                    </div>


                </div>
                <hr class="simple" color="#868e96"/>
                <div class="col-md-12" id="docList">


                </div>

            </div>

        </main>
        <!--End 页面主要内容-->
    </div>
</div>

<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/url.js"></script>
<script type="text/javascript" src="js/check.js"></script>
<script type="text/javascript" src="js/localStorage.js"></script>
<script type="text/javascript"
        src="https://www.17sucai.com/preview/1/2017-08-21/bootstrap-fileinput/js/bootstrap-fileinput.js"></script>
<script>

    var data = foowwLocalStorage.get('tocken');
    var obj = JSON.parse(data);

    var projectId = sessionStorage.getItem('projectId');
    var objs = JSON.parse(projectId);

    function hrefAdd() {
        location.href = "projectDocAdd.html"
    }

    function hrefIndex() {
        location.href = "index.html";
    }

    function docList(res) {
        console.log(res);
        $.ajax({
            type: "get",
            dataType: "json",
            url: GlobalConfig.IPSSAddress + "iot/project/getProjectDocList",
            beforeSend: function (XMLHttpRequest) {
                XMLHttpRequest.setRequestHeader("Authorization", "Bearer " + obj["access_token"]);
            },
            data: {
                "projectDocType": res,
                "projectId": objs
            },
            success: function (res) {
                console.log(res);
                var html = "";
                for (var i = 0; i < res.data.length; i++) {
                    html += "<div class=\"col-md-1\" onclick=\"window.open('" + res.data[i].projectDocUrl + "')\">\n" +
                        "                        <div class=\"card\">\n" +
                        "                            <img src=\"images/pdf.png\" href=>\n" +
                        "                            <div class=\"card-header\">" + res.data[i].projectDocName + "</div>\n" +
                        "                        </div>\n" +
                        "                    </div>";

                }
                $("#docList").html(html);

            }
        })

    }

    $(function () {
        //比较简洁，细节可自行完善
        docList(1);
        $.ajax({
            type: "get",
            dataType: "json",
            url: GlobalConfig.IPSSAddress + "iot/project/projectInfo",
            data: {
                "projectId": objs,
            },
            beforeSend: function (XMLHttpRequest) {
                XMLHttpRequest.setRequestHeader("Authorization", "Bearer " + obj["access_token"]);
            },
            success: function (res) {
                $("#logo").html(" <h2 onclick='hrefIndex()' style=\"text-align: center\">←" + res.data.projectName + "</h2>");
            }
        });

        $(function () {

            $.ajax({
                type: "get",
                dataType: "json",
                url: GlobalConfig.IPSSAddress + "admin/menu/tree",
                success: function (res) {
                    console.log(res);
                    var tree = JSON.parse(JSON.stringify(res));
                    var html = "";
                    for (var i = 0; i < tree.data.length; i++) {
                        if (tree.data[i].id == 2000) {
                            for (var k = 0; k < tree.data[i].children.length; k++) {
                                html += "<li class=\"nav-item  \">" +
                                    "<a href=" + tree.data[i].children[k].path + ".html" + ">" + tree.data[i].children[k].name + "</a>" +
                                    "<ul class=\"nav nav-subnav\">\n" +
                                    "</ul>" +
                                    "</li>";
                            }
                        }
                    }
                    $("#menuList").html(html);

                }
            })

            function getQueryString() {
                var obg = {}, a = '';
                (a = window.location.search.substr(1)) || (a = window.location.hash.split('?')[1])
                a.split(/&/g).forEach(function (item) {
                    obg[(item = item.split('='))[0]] = item[1];
                })
                return obg
            }

        });

    });
</script>