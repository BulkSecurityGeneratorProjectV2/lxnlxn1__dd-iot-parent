<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="utf-8">
    <title>项目文档</title>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link href="css/bootstrap.min.css" rel="stylesheet">
    <link href="css/materialdesignicons.min.css" rel="stylesheet">
    <link href="css/style.min.css" rel="stylesheet">
    <link href="https://www.17sucai.com/preview/1/2017-08-21/bootstrap-fileinput/css/bootstrap-fileinput.css"
          rel="stylesheet">
</head>

<body>
<div class="lyear-layout-web">
    <div class="lyear-layout-container">
        <!--左侧导航-->
        <aside class="lyear-layout-sidebar">
            <!-- logo -->
            <div id="logo" class="sidebar-header">

            </div>
            <div class="lyear-layout-sidebar-scroll">

                <nav class="sidebar-main">
                    <ul class="nav nav-drawer" id="menuList">


                    </ul>
                </nav>

            </div>
        </aside>
        <!--End 左侧导航-->
        <!--页面主要内容-->
        <main class="lyear-layout-content">

            <div class="container-fluid">
                <form id="uploadForm" method="post" enctype="multipart/form-data">
                    <div class="row form-group">
                        <div class="form-control">
                            <select name="type" class="form-control" id="projectDocType" name="projectDocType">
                                <option value="1">安装施工图</option>
                                <option value="2">系统拓扑图</option>
                                <option value="3">电器原理图</option>
                                <option value="4">网络拓扑图</option>
                                <option value="5">设备点位图</option>
                            </select>
                        </div>

                    </div>
                    <div class="row form-group">
                        <div class="form-control">
                            <input type="text" id="projectDocName" name="projectDocName" class="form-control"
                                   placeholder="图片名称">
                        </div>

                    </div>
                    <div class="row form-group">
                        <div class="panel panel-primary">
                            <div class="panel-body">
                                <div class="col-sm-10">
                                    <input type="file" id="projectFile" name="projectFile"/>
                                </div>
                            </div>
                        </div>
                    </div>
                    <button type="button" id="uploadSubmit" class="btn btn-info">提交</button>
                </form>
            </div>

        </main>
        <!--End 页面主要内容-->
    </div>
</div>

<script type="text/javascript" src="js/jquery.min.js"></script>
<script type="text/javascript" src="js/bootstrap.min.js"></script>
<script type="text/javascript" src="js/url.js"></script>
<script type="text/javascript" src="js/check.js"></script>
<script type="text/javascript"
        src="https://www.17sucai.com/preview/1/2017-08-21/bootstrap-fileinput/js/bootstrap-fileinput.js"></script>
<script>

    var projectId = sessionStorage.getItem('projectId');
    var objs = JSON.parse(projectId);
    $(function () {
        //比较简洁，细节可自行完善
        $('#uploadSubmit').click(function () {
            var formData = new FormData();
            var data = $('#projectFile')[0].files[0];
            var name = $('#projectFile').val();
            formData.append('fileImg', data);

            $.ajax({
                url: GlobalConfig.IPSSAddress + 'iot/project/upload',
                type: 'POST',
                data: formData,
                contentType: false,
                processData: false,
                mimeType: "multipart/form-data",
                success: function (res) {
                    var res = JSON.parse(res);
                    if (res.code == 0) {

                        var dataJson = {
                            "projectId": objs,
                            "projectDocName": $('#projectDocName').val(),
                            "projectDocType": $('#projectDocType option:selected').val(),
                            "projectDocUrl": "http://192.168.1.117:9000/" + res.data.bucketName + "/" + res.data.fileName,
                        }
                        $.ajax({
                            url: GlobalConfig.IPSSAddress + 'iot/project/projectDocSave',
                            type: 'POST',
                            dataType: "json",
                            contentType: 'application/json;charset=utf-8',
                            data: JSON.stringify(dataJson),
                            success: function (data) {
                                alert("添加成功");
                                location.href = "projectDoc.html";
                            },
                            error: function (data) {
                                alert("失败");
                            }
                        });
                    }

                },
                error: function (data) {
                    console.log(data);
                }
            });

        })
        $(function () {

            $.ajax({
                type: "get",
                dataType: "json",
                url: GlobalConfig.IPSSAddress + "admin/menu/tree",
                success: function (res) {
                    console.log(res);
                    var tree = JSON.parse(JSON.stringify(res));
                    var html = "";
                    for (var i = 0; i < tree.data.length; i++) {
                        if (tree.data[i].id == 2000) {
                            for (var k = 0; k < tree.data[i].children.length; k++) {
                                html += "<li class=\"nav-item  \" href=" + tree.data[i].children[k].path + ".html" + ">" +
                                    "<a>" + tree.data[i].children[k].name + "</a>" +
                                    "<ul class=\"nav nav-subnav\">\n" +
                                    "</ul>" +
                                    "</li>";
                            }

                        }


                    }
                    $("#menuList").html(html);

                }
            })
        })

        function getQueryString() {
            var obg = {}, a = '';
            (a = window.location.search.substr(1)) || (a = window.location.hash.split('?')[1])
            a.split(/&/g).forEach(function (item) {
                obg[(item = item.split('='))[0]] = item[1];
            })
            return obg
        }

        var data = localStorage.getItem('tocken');
        var obj = JSON.parse(data);
    });
</script>